<!DOCTYPE html>
<html lang="es">

<head>
 <meta charset="UTF-8">
 <meta name="viewport"
   content="width=device-width">
 <title>Select</title>
 <link rel="preconnect"
   href="https://fonts.googleapis.com">
 <link rel="preconnect"
   href="https://fonts.gstatic.com"
   crossorigin>
 <link rel="stylesheet"
   href="https://fonts.googleapis.com/css2?family=Roboto&display=swap">
 <style>
  html {
   --Font: -apple-system,
    BlinkMacSystemFont, Roboto,
    sans-serif;
   --LabelLargeFont: var(--Font);
   --LabelLargeSize: 14px;
   --LabelLargeWeight: 500;
   --BodyLargeFont: var(--Font);
   --BodyLargeSize: 16px;
   --BodyLargeWeight: 400;
   --BodySmallFont: var(--Font);
   --BodySmallSize: 12px;
   --BodySmallWeight: 400;
   --Background: #FFFBFE;
   --OnBackground: #1C1B1F;
   --Surface: #FFFBFE;
   --OnSurface: #1C1B1F;
   --OnSurfaceHover: #1C1B1F14;
   --OnSurfaceFocus: #1C1B1F19;
   --OnSurfacePressed: #1C1B1F1E;
   --OnSurfaceShadow: #1C1B1F99;
   --SurfaceVariant: #E7E0EC;
   --SurfaceVariantHover:
    #CAC4D0;
   --OnSurfaceVariant: #49454F;
   --Primary: #6750A4;
   --OnPrimary: #FFFFFF;
   --Error: #B3261E;
   --OnErrorContainer: #F2B8B5;
   --Elevation: #F5EEFA;
   --ShapeCornerMedium: 12px;
   --ShapeCornerExtraSmall: 4px;
   --ElevationLevel2:
    0 3px 6px 0px var(--OnSurfaceShadow);
   font-size: 16px;
   font-family: var(--Font);
   color: var(--OnBackground);
   background-color:
    var(--Background);
  }

  /* Quita un borde rojo que coloca
   * Firefox. */
  :-moz-ui-invalid {
   box-shadow: none;
  }
 </style>
 <script>
  // @ts-check
  const INVALID_CLASS = "invalid"
  const POPULATED_CLASS =
   "populated"
  const OPEN_CLASS = "open"
  const SELECTED_CLASS = "selected"
  const LABEL_NAME = 'name="label"'
  const SUPPORTING_NAME =
   'name="supporting"'
  const MENU_ID = "menu"
  const MENU_SLOT_ID = "menuSlot"
  const NAME_PROPERTY = "name"
  const VALUE_PROPERTY = "value"
  const REQUIRED_PROPERTY =
   "required"
  const SELECT_MENU_TAG =
   "select-menu"

  /**
   * @param {HTMLElement} element
   * @param {string} element
   * @returns {string}
   */
  function getAttribute(element,
   name) {
   const value =
    element.getAttribute(name)
   return value === null ?
    ""
    : value
  }

  /**
   * @param {HTMLElement} element
   * @param {string} name
   * @param {boolean} value
   */
  function setBooleanAttribute(
   element, name, value) {
   if (value) {
    this.setAttribute(name, name)
   } else {
    this.removeAttribute(name)
   }
  }

  class MenuOption
   extends HTMLElement {

   static
    get observedAttributes() {
    return [VALUE_PROPERTY]
   }

   constructor() {
    super()
    /**
     * @private
     * @type {HTMLInputElement|
     *        null}
     */
    this._radio = null
   }

   /**
    * @param {string} name
    * @param {string} _oldValue
    * @param {string} newValue
    */
   attributeChangedCallback(name,
    _oldValue, newValue) {
    if (name === VALUE_PROPERTY) {
     this.radio.value = newValue
    }
   }

   get radio() {
    if (this._radio === null) {
     this._radio = this.
      appendChild(document.
       createElement("input"))
     this._radio.type = "radio"
     this.radio.style.transform =
      "scaleY(0)"
    }
    return this._radio
   }

   get value() {
    return getAttribute(this,
     VALUE_PROPERTY)
   }

   /** @param {string} value */
   setValue(value) {
    this.setAttribute(
     VALUE_PROPERTY, value)
   }
  }

  customElements.define(
   "menu-option", MenuOption)

  class SelectMenu
   extends HTMLElement {

   static
    get observedAttributes() {
    return [VALUE_PROPERTY]
   }

   constructor() {
    super()
    /**
     * @private
     * @type {ShadowRoot}
     */
    this._shadow =
     this.attachShadow({
      mode: "open"
     })
    this._shadow.innerHTML =
     /* html */
     `<style>
      :host {
       display: block;
       position:relative;
       margin: 1rem;
      }

      label {
       display: block;
      }

      span::after {
       content: "";
       background-color:
        var(--SurfaceVariant);
       position: absolute;
       z-index: -1;
       top: 0;
       right: 0;
       left: 0;
       bottom: 0;
      }

      span {
       border-top-left-radius:
        var(
         --ShapeCornerExtraSmall);
       border-top-right-radius:
        var(
         --ShapeCornerExtraSmall);
        position: relative;
       display: block;
       cursor: pointer;
       padding: 24px 0 0 0;
       overflow: hidden;
      }

      [${LABEL_NAME}]::slotted(*) {
       color:
        var(--OnSurfaceVariant);
       font-family:
        var(--BodyLargeFont);
       font-size:
        var(--BodyLargeSize);
       font-weight:
        var(--BodyLargeWeight);
       position: absolute;
       top: 24px;
       left: 1rem;
       transition: 0.3s ease-in;
      }

      :host(:focus) [${LABEL_NAME}]::slotted(*),
      :host(.${POPULATED_CLASS}) [${LABEL_NAME}]::slotted(*),
      :host(.float) [${LABEL_NAME}]::slotted(*) {
       transform:
        translateY(-16px);
       font-size:
        var(--BodySmallSize);
      }

      output {
       border-bottom-width: 1px;
       border-bottom-style: solid;
       border-bottom-color:
       var(--OnSurfaceVariant);
       color: var(--OnSurface);
       font-family:
        var(--BodyLargeFont);
       font-size:
        var(--BodyLargeSize);
       font-weight:
        var(--BodyLargeWeight);
       border-top: none;
       border-left: none;
       border-right: none;
       display: block;
       box-sizing: border-box;
       padding: 0 16px 8px 16px;
       background-color:
        transparent;
       resize: none;
       outline: none;
       width: 100%;
       transition: 0.3s ease-in;
       height: 32px;
       line-height: 23px;
       background-position: center;
       background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='5' width='32'%3E%3Cpath d='M21 4 16 0 26 0 Z' fill='%2349454E' /%3E%3C/svg%3E");
       background-repeat: no-repeat;
       background-position-x: right;
       background-position-y: 20%;
       padding-right: 32px;
       cursor: pointer;
      }

      :host(.open) output {
       background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='5' width='32'%3E%3Cpath d='M21 0 16 4 26 4 Z' fill='%2349454E' /%3E%3C/svg%3E");
      }

      [${SUPPORTING_NAME}]::slotted(*) {
       color:
        var(--OnSurfaceVariant);
       font-family:
        var(--BodySmallFont);
       font-size:
        var(--BodySmallSize);
       font-weight:
        var(--BodySmallWeight);
       padding: 4px 16px 0 16px;
       display: block;
       transition: 0.3s ease-in;
      }

      :host(:focus)  {
       outline: none;
      }

      :host(:focus) [${LABEL_NAME}]::slotted(*)  {
       color: var(--Primary);
      }

      :host(:focus) output {
       border-bottom-width: 2px;
       border-bottom-color:
        var(--Primary);
       padding-bottom: 7px;
       outline: none;
      }

      :host(:hover) span {
       background-color:
        var(--SurfaceVariantHover);
      }

      :host(:hover) output {
       border-bottom-width: 1px;
       border-bottom-color:
        var(--OnSurface);
        padding-bottom: 8px;
      }

      :host(.${INVALID_CLASS}) output,
      :host(.${INVALID_CLASS}:focus) output {
       border-bottom-color:
        var(--Error);
      }

      :host(.${INVALID_CLASS}) [${LABEL_NAME}]::slotted(*) {
       color: var(--Error);
      }

      :host(.${INVALID_CLASS}) [${SUPPORTING_NAME}]::slotted(*) {
       color: var(--Error);
      }

      :host(.${INVALID_CLASS}:hover) output {
       border-bottom-color:
        var(--OnErrorContainer);
      }

      :host(.${INVALID_CLASS}:hover) [${LABEL_NAME}]::slotted(*) {
       color: var(--OnSurfaceVariant);
      }

      :host(.${INVALID_CLASS}:hover:focus) [${LABEL_NAME}]::slotted(*) {
       color: var(--Error);
      }

      :host(.${INVALID_CLASS}:hover:focus) output {
       border-bottom-width: 2px;
       padding-bottom: 7px;
      }
      
      #${MENU_ID} {
       display: block;
       position: absolute;
       z-index: 1;
       right: 0;
       left: 0;
       top: 57px;
       pointer-events: none;
       transform:
        translateY(-50%) scaleY(0);
       transition: transform 0.5s;
       box-sizing: border-box;
       padding: 4px 0;
       border-bottom-left-radius:
        var(--ShapeCornerMedium);
       border-bottom-right-radius:
        var(--ShapeCornerMedium);
       background-color:
        var(--Elevation);
       cursor: default;
       box-shadow:
        var(--ElevationLevel2);
      }

      :host(.open) #${MENU_ID} {
       pointer-events: all;
       transform:
        translateY(0) scaleY(1);
      }

      #${MENU_SLOT_ID}::slotted(*) {
       display: block;
       border: none;
       background-color:
        transparent;
       color: var(--OnSurface);
       font-family:
        var(--LabelLargeFont);
       font-size:
        var(--LabelLargeSize);
       font-weight:
        var(--LabelLargeWeight);
       box-sizing: border-box;
       padding: 4px 0;
       width: 100%;
       height: 48px;
       line-height: 48px;
       padding: 0 12px;
       white-space: nowrap;
       text-overflow: ellipsis;
       overflow: hidden;
       text-align: start;
      }

      #${MENU_SLOT_ID}::slotted(:hover) {
       background-color:
        var(--OnSurfaceHover);
      }

      #${MENU_SLOT_ID}::slotted(:active) {
       background-color:
        var(--Primary);
       background-position: center;
       background-image: radial-gradient(circle, transparent 1%, var(--SurfaceVariant) 1%);
       background-size: 100%;
       animation-fill-mode: forwards;
       animation-name: ripple;
       animation-duration: 0.5s;
      }

      #${MENU_SLOT_ID}::slotted(.selected) {
       color: var(--OnPrimary);
       background-color: var(--Primary);
      }
     </style>
     <label>
      <span>
       <slot ${LABEL_NAME}></slot>
       <output></output>
      </span>
      <slot
       ${SUPPORTING_NAME}></slot>
     </label>
     <div id="${MENU_ID}">
      <slot
       id="${MENU_SLOT_ID}"></slot>
     </div>`
    this._alterna =
     this._alterna.bind(this)
    this._abre =
     this._abre.bind(this)
    this._cierra =
     this._cierra.bind(this)
    /**
     * @private
     * @type {HTMLLabelElement|
     *        null}
     */
    this._label = this._shadow.
     querySelector("label")
    /**
     * @private
     * @type {HTMLOutputElement|
     *        null}
     */
    this._target = this._shadow.
     querySelector("output")
    /**
     * @private
     * @type {HTMLElement|null}
     */
    this._menu = this.
     _shadow.querySelector(
      `#${MENU_ID}`
     )
    /**
     * @private
     * @type {HTMLSlotElement|null}
     */
    this._menuSlot = this._shadow.
     querySelector(
      `#${MENU_SLOT_ID}`)
    this.addEventListener(
     "keydown",
     evt => this._onKeyDown(evt))
    if (this._target !== null) {
     this._target.addEventListener(
      "click", this._alterna)
    }
    if (this._menu !== null) {
     this._menu.addEventListener(
      "click",
      evt => this._onClick(evt),
      { capture: true })
    }
    if (this._menuSlot !== null) {
     this._menuSlot.
      addEventListener(
       "slotchange", () =>
       this._cambiaValue())
    }
   }

   connectedCallback() {
    this.tabIndex = 0
   }

   /**
    * @param {string} name
    * @param {string} _oldValue
    * @param {string} _newValue
    */
   attributeChangedCallback(name,
    _oldValue, _newValue) {
    if (name
     === REQUIRED_PROPERTY) {
     this.analiza()
    } else if (name
     === VALUE_PROPERTY
     || name === NAME_PROPERTY) {
     this._cambiaValue()
    }
   }

   get name() {
    return getAttribute(this,
     NAME_PROPERTY)
   }

   set name(name) {
    this.setAttribute(
     VALUE_PROPERTY, name)
   }

   get type() {
    return SELECT_MENU_TAG.
     toUpperCase()
   }

   get required() {
    return this.hasAttribute(
     REQUIRED_PROPERTY)
   }

   set required(required) {
    setBooleanAttribute(this,
     REQUIRED_PROPERTY, required)
   }

   get value() {
    return getAttribute(this,
     VALUE_PROPERTY)
   }

   set value(value) {
    this.setAttribute(
     VALUE_PROPERTY, value)
   }

   analiza() {
    const t = this._target
    if (t !== null) {
     let value = this.value
     if (value === "") {
      this.classList.
       remove(POPULATED_CLASS)
     } else {
      this.classList.
       add(POPULATED_CLASS)
     }
     if (this.checkValidity()) {
      this.classList.
       remove(INVALID_CLASS)
     } else {
      this.classList.
       add(INVALID_CLASS)
     }
    }
   }

   /** @returns {boolean} */
   checkValidity() {
    return !this.required ||
     this.value !== ""
   }

   /** @private */
   _alterna() {
    if (this.classList.
     contains(OPEN_CLASS)) {
     this._cierra()
    } else {
     this._abre()
    }
   }

   /** @private */
   _abre() {
    this.classList.add(OPEN_CLASS)
    this.addEventListener(
     "focusout", this._cierra,
     { capture: false })
   }

   /** @private */
   _cierra() {
    this.removeEventListener(
     "focusout", this._cierra,
     { capture: false })
    this.classList.
     remove(OPEN_CLASS)
   }

   /** @private */
   _cambiaValue() {
    const value = this.value
    const name = this.name
    for (const o
     of this._opciones) {
     if (name !== "") {
      o.radio.name = name
     }
     if (o.value === value) {
      o.radio.checked = true
      const text =
       o.textContent.trim()
      this._text = text
      o.classList.
       add(SELECTED_CLASS)
     } else {
      o.radio.checked = false
      o.classList.
       remove(SELECTED_CLASS)
     }
    }
    this.analiza()
   }
   /**
    * @param {KeyboardEvent
    *        } evt
    */
   _onKeyDown(evt) {
    const key = evt.key
    if (this.classList
     .contains(OPEN_CLASS)) {
     if (key === "Tab") {
      evt.preventDefault()
      this._alterna()
     } else if (key
      === "ArrowDown") {
      evt.preventDefault()
      this._avanzaOpcion()
     } else if (key
      === "ArrowUp") {
      evt.preventDefault()
      this._retrocedeOpcion()
     } else if (key
      === "Escape") {
      evt.preventDefault()
      this._cierra()
     }
    } else if (key !== "Tab") {
     evt.preventDefault()
     this._alterna()
    }
   }
   /**
    * @private
    * @param {Event} evt
    */
   _onClick(evt) {
    const sel = evt.target
    let value = this.value
    for (const o
     of this._opciones) {
     if (o === sel) {
      value = o.value
      break
     }
    }
    this._cierra()
    this.value = value
    this.analiza()
    this.dispatchEvent(
     new Event("input"))
   }

   /**
    * @private
    * @returns {MenuOption[]}
    */
   get _opciones() {
    const arr = []
    const m = this._menuSlot
    const elements =
     m.assignedElements()
    for (const o of elements) {
     if (o
      instanceof MenuOption) {
      arr.push(o)
     }
    }
    return arr
   }

   /**
    * @private
    * @returns {string}
    */
   get _text() {
    const t = this._target
    return t === null ?
     ""
     : t.value
   }

   /**
    * @private
    * @param {string} text
    */
   set _text(text) {
    const t = this._target
    if (t !== null) {
     t.value = text
    }
   }

   /** @private */
   _avanzaOpcion() {
    const i = this._valueIndex
    const opciones = this._opciones
    if (i < opciones.length - 1) {
     this.value =
      opciones[i + 1].value
    }
   }

   /** @private */
   _retrocedeOpcion() {
    const i = this._valueIndex
    const opciones = this._opciones
    if (i > 0) {
     this.value =
      opciones[i - 1].value
    }
   }

   /**
    * @private
    * @returns {number}
    */
   get _valueIndex() {
    const value = this.value
    return this._opciones.
     findIndex(
      o => o
       instanceof MenuOption &&
       o.value === value)
   }
  }

  customElements.define(
   SELECT_MENU_TAG, SelectMenu)

 </script>
 <style>
  @keyframes ripple {
   from {
    color: var(--OnSurfaceVariant);
    background-size: 100%;
   }

   to {
    color: var(--OnPrimary);
    background-size: 15000%;
   }
  }
 </style>
</head>

<body>
 <form>
  <h1>Select</h1>
  <section style="max-width: 600px;
   margin: 0 auto">
   <select-menu required
     name="grupo" value="IC22">
    <span slot="label">Grupo</span>
    <menu-option value="">
    </menu-option>
    <menu-option value="IC21">
     IC-21
    </menu-option>
    <menu-option value="IC22">
     IC-22
    </menu-option>
    <menu-option value="IC23">
     IC-23
    </menu-option>
   </select-menu>
  </section>
  <p><button>Enviar</button></p>
 </form>
</body>

</html>